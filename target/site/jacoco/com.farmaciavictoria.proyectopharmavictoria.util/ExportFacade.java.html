<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExportFacade.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">proyectopharmavictoria</a> &gt; <a href="index.source.html" class="el_package">com.farmaciavictoria.proyectopharmavictoria.util</a> &gt; <span class="el_source">ExportFacade.java</span></div><h1>ExportFacade.java</h1><pre class="source lang-java linenums">package com.farmaciavictoria.proyectopharmavictoria.util;

import javafx.collections.ObservableList;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import com.farmaciavictoria.proyectopharmavictoria.controller.reportes.export.ReporteTipo;
import com.farmaciavictoria.proyectopharmavictoria.model.Inventario.Producto;

import java.io.FileOutputStream;
import java.io.File;
import java.io.File;
import java.io.IOException;
import java.time.format.DateTimeFormatter;
import java.util.List;

<span class="nc" id="L17">public class ExportFacade {</span>

    // Exportar usuarios a Excel
    public static void exportarUsuariosExcel(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario&gt; usuarios, String nombreArchivo) {
<span class="fc" id="L22">        try (Workbook workbook = new XSSFWorkbook()) {</span>
<span class="fc" id="L23">            Sheet sheet = workbook.createSheet(&quot;Usuarios&quot;);</span>
<span class="fc" id="L24">            String[] headers = { &quot;Usuario&quot;, &quot;Nombres&quot;, &quot;Apellidos&quot;, &quot;DNI&quot;, &quot;Teléfono&quot;, &quot;Email&quot;, &quot;Rol&quot;, &quot;Estado&quot; };</span>
<span class="fc" id="L25">            short verdeA = IndexedColors.BRIGHT_GREEN.getIndex();</span>
<span class="fc" id="L26">            int logoRow = 0;</span>
            try {
<span class="fc" id="L28">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L29" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L30">                    byte[] bytes = is.readAllBytes();</span>
<span class="fc" id="L31">                    int pictureIdx = workbook.addPicture(bytes, Workbook.PICTURE_TYPE_PNG);</span>
<span class="fc" id="L32">                    org.apache.poi.ss.usermodel.Drawing&lt;?&gt; drawing = sheet.createDrawingPatriarch();</span>
<span class="fc" id="L33">                    org.apache.poi.ss.usermodel.ClientAnchor anchor = workbook.getCreationHelper().createClientAnchor();</span>
<span class="fc" id="L34">                    anchor.setCol1(0);</span>
<span class="fc" id="L35">                    anchor.setRow1(logoRow);</span>
<span class="fc" id="L36">                    anchor.setCol2(2);</span>
<span class="fc" id="L37">                    anchor.setRow2(logoRow + 3);</span>
<span class="fc" id="L38">                    drawing.createPicture(anchor, pictureIdx);</span>
<span class="fc" id="L39">                    logoRow = 3;</span>
                }
<span class="nc" id="L41">            } catch (Exception ex) {</span>
<span class="fc" id="L42">                /* Si falla, ignora el logo */ }</span>

<span class="fc" id="L44">            Row titleRow = sheet.createRow(logoRow + 1);</span>
<span class="fc" id="L45">            Cell titleCell = titleRow.createCell(0);</span>
<span class="fc" id="L46">            titleCell.setCellValue(&quot;Listado de Usuarios&quot;);</span>
<span class="fc" id="L47">            Font titleFont = workbook.createFont();</span>
<span class="fc" id="L48">            titleFont.setBold(true);</span>
<span class="fc" id="L49">            titleFont.setFontHeightInPoints((short) 18);</span>
<span class="fc" id="L50">            titleFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L51">            CellStyle titleStyle = workbook.createCellStyle();</span>
<span class="fc" id="L52">            titleStyle.setFont(titleFont);</span>
<span class="fc" id="L53">            titleStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L54">            titleStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L55">            titleStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L56">            titleCell.setCellStyle(titleStyle);</span>
<span class="fc" id="L57">            sheet.addMergedRegion(</span>
                    new org.apache.poi.ss.util.CellRangeAddress(logoRow + 1, logoRow + 1, 0, headers.length - 1));

<span class="fc" id="L60">            CellStyle headerStyle = workbook.createCellStyle();</span>
<span class="fc" id="L61">            headerStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L62">            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L63">            headerStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L64">            Font headerFont = workbook.createFont();</span>
<span class="fc" id="L65">            headerFont.setBold(true);</span>
<span class="fc" id="L66">            headerFont.setFontHeightInPoints((short) 14);</span>
<span class="fc" id="L67">            headerFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L68">            headerStyle.setFont(headerFont);</span>
<span class="fc" id="L69">            headerStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L70">            headerStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L71">            headerStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L72">            headerStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L74">            CellStyle cellStyle = workbook.createCellStyle();</span>
<span class="fc" id="L75">            cellStyle.setAlignment(HorizontalAlignment.LEFT);</span>
<span class="fc" id="L76">            cellStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L77">            cellStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L78">            cellStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L79">            cellStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L81">            Row header = sheet.createRow(logoRow + 2);</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L83">                Cell cell = header.createCell(i);</span>
<span class="fc" id="L84">                cell.setCellValue(headers[i]);</span>
<span class="fc" id="L85">                cell.setCellStyle(headerStyle);</span>
<span class="fc" id="L86">                sheet.setColumnWidth(i, 5000);</span>
            }
<span class="fc" id="L88">            header.setHeightInPoints(28);</span>

<span class="fc" id="L90">            usuarios.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario::getNombres,
<span class="fc" id="L92">                    java.text.Collator.getInstance()));</span>
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">            for (int i = 0; i &lt; usuarios.size(); i++) {</span>
<span class="nc" id="L94">                com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario u = usuarios.get(i);</span>
<span class="nc" id="L95">                Row row = sheet.createRow(logoRow + 3 + i);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">                row.createCell(0).setCellValue(u.getUsername() != null ? u.getUsername() : &quot;&quot;);</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">                row.createCell(1).setCellValue(u.getNombres() != null ? u.getNombres() : &quot;&quot;);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                row.createCell(2).setCellValue(u.getApellidos() != null ? u.getApellidos() : &quot;&quot;);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">                row.createCell(3).setCellValue(u.getDni() != null ? u.getDni() : &quot;&quot;);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">                row.createCell(4).setCellValue(u.getTelefono() != null ? u.getTelefono() : &quot;&quot;);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">                row.createCell(5).setCellValue(u.getEmail() != null ? u.getEmail() : &quot;&quot;);</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">                row.createCell(6).setCellValue(u.getRol() != null ? u.getRol().getDescripcion() : &quot;&quot;);</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                row.createCell(7).setCellValue(u.isActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                for (int j = 0; j &lt; headers.length; j++) {</span>
<span class="nc" id="L105">                    row.getCell(j).setCellStyle(cellStyle);</span>
                }
            }
<span class="fc bfc" id="L108" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L109">                sheet.autoSizeColumn(i);</span>
            }
<span class="fc" id="L111">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L112">            Row footer = sheet.createRow(logoRow + 3 + usuarios.size() + 1);</span>
<span class="fc" id="L113">            Cell cellFooter = footer.createCell(0);</span>
<span class="fc" id="L114">            cellFooter.setCellValue(&quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt));</span>
<span class="fc" id="L115">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(footer.getRowNum(), footer.getRowNum(), 0,</span>
                    headers.length - 1));
<span class="fc" id="L117">            cellFooter.setCellStyle(cellStyle);</span>

<span class="fc" id="L119">            try (FileOutputStream fos = new FileOutputStream(nombreArchivo + &quot;.xlsx&quot;)) {</span>
<span class="fc" id="L120">                workbook.write(fos);</span>
            }
<span class="nc" id="L122">        } catch (IOException e) {</span>
<span class="nc" id="L123">            e.printStackTrace();</span>
<span class="fc" id="L124">        }</span>
<span class="fc" id="L125">    }</span>

    // Exportar usuarios a PDF
    public static void exportarUsuariosPDF(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario&gt; usuarios, String nombreArchivo) {
        try {
<span class="fc" id="L131">            com.itextpdf.text.Document document = new com.itextpdf.text.Document();</span>
<span class="fc" id="L132">            java.io.FileOutputStream fos = null;</span>
            try {
<span class="fc" id="L134">                fos = new java.io.FileOutputStream(nombreArchivo + &quot;.pdf&quot;);</span>
<span class="nc" id="L135">            } catch (java.io.FileNotFoundException fnfe) {</span>
<span class="nc" id="L136">                System.err.println(&quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;);</span>
<span class="nc" id="L137">                javax.swing.JOptionPane.showMessageDialog(null,</span>
                        &quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;,
                        &quot;Error de exportación&quot;, javax.swing.JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L140">                return;</span>
<span class="fc" id="L141">            }</span>
<span class="fc" id="L142">            com.itextpdf.text.pdf.PdfWriter.getInstance(document, fos);</span>
<span class="fc" id="L143">            document.open();</span>
            // Logo
            try {
<span class="fc" id="L146">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L148">                    com.itextpdf.text.Image logo = com.itextpdf.text.Image.getInstance(is.readAllBytes());</span>
<span class="fc" id="L149">                    logo.scaleToFit(120, 120);</span>
<span class="fc" id="L150">                    logo.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L151">                    document.add(logo);</span>
                }
<span class="nc" id="L153">            } catch (Exception ex) {</span>
<span class="fc" id="L154">                /* Si falla, ignora el logo */ }</span>

<span class="fc" id="L156">            com.itextpdf.text.Font titleFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    18, com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L158">            com.itextpdf.text.Paragraph title = new com.itextpdf.text.Paragraph(&quot;Listado de Usuarios&quot;, titleFont);</span>
<span class="fc" id="L159">            title.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L160">            document.add(title);</span>
<span class="fc" id="L161">            document.add(new com.itextpdf.text.Paragraph(&quot; &quot;));</span>

<span class="fc" id="L163">            String[] headers = { &quot;Usuario&quot;, &quot;Nombres&quot;, &quot;Apellidos&quot;, &quot;DNI&quot;, &quot;Teléfono&quot;, &quot;Email&quot;, &quot;Rol&quot;, &quot;Estado&quot; };</span>
<span class="fc" id="L164">            com.itextpdf.text.pdf.PdfPTable table = new com.itextpdf.text.pdf.PdfPTable(headers.length);</span>
<span class="fc" id="L165">            table.setWidthPercentage(100);</span>
<span class="fc" id="L166">            table.setSpacingBefore(10f);</span>
<span class="fc" id="L167">            table.setSpacingAfter(10f);</span>
<span class="fc" id="L168">            float[] columnWidths = { 1.5f, 2f, 2f, 1.5f, 1.5f, 2f, 1.5f, 2f };</span>
<span class="fc" id="L169">            table.setWidths(columnWidths);</span>

<span class="fc" id="L171">            com.itextpdf.text.Font headerFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    13, com.itextpdf.text.Font.BOLD, com.itextpdf.text.BaseColor.WHITE);
<span class="fc" id="L173">            com.itextpdf.text.Font cellFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    11, com.itextpdf.text.Font.NORMAL, com.itextpdf.text.BaseColor.BLACK);

<span class="fc bfc" id="L176" title="All 2 branches covered.">            for (String h : headers) {</span>
<span class="fc" id="L177">                com.itextpdf.text.pdf.PdfPCell cell = new com.itextpdf.text.pdf.PdfPCell(</span>
                        new com.itextpdf.text.Phrase(h, headerFont));
<span class="fc" id="L179">                cell.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L180">                cell.setBackgroundColor(new com.itextpdf.text.BaseColor(40, 167, 69));</span>
<span class="fc" id="L181">                cell.setBorderColor(new com.itextpdf.text.BaseColor(32, 201, 151));</span>
<span class="fc" id="L182">                cell.setPadding(7f);</span>
<span class="fc" id="L183">                cell.setBorderWidth(1.5f);</span>
<span class="fc" id="L184">                table.addCell(cell);</span>
            }

<span class="fc" id="L187">            usuarios.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario::getNombres,
<span class="fc" id="L189">                    java.text.Collator.getInstance()));</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">            for (com.farmaciavictoria.proyectopharmavictoria.model.Usuario.Usuario u : usuarios) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getUsername() != null ? u.getUsername() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getNombres() != null ? u.getNombres() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getApellidos() != null ? u.getApellidos() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getDni() != null ? u.getDni() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getTelefono() != null ? u.getTelefono() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.getEmail() != null ? u.getEmail() : &quot;&quot;, cellFont));</span>
<span class="nc" id="L197">                table.addCell(</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                        new com.itextpdf.text.Phrase(u.getRol() != null ? u.getRol().getDescripcion() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(u.isActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;, cellFont));</span>
<span class="nc" id="L200">            }</span>
<span class="fc" id="L201">            document.add(table);</span>
<span class="fc" id="L202">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L203">            com.itextpdf.text.Paragraph footer = new com.itextpdf.text.Paragraph(</span>
<span class="fc" id="L204">                    &quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt), cellFont);</span>
<span class="fc" id="L205">            footer.setAlignment(com.itextpdf.text.Element.ALIGN_RIGHT);</span>
<span class="fc" id="L206">            document.add(footer);</span>
<span class="fc" id="L207">            document.close();</span>
<span class="nc" id="L208">        } catch (Exception e) {</span>
<span class="nc" id="L209">            e.printStackTrace();</span>
<span class="fc" id="L210">        }</span>
<span class="fc" id="L211">    }</span>

    // Exportar clientes a Excel
    public static void exportarClientesExcel(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente&gt; clientes, String nombreArchivo) {
<span class="fc" id="L216">        try (Workbook workbook = new XSSFWorkbook()) {</span>
<span class="fc" id="L217">            Sheet sheet = workbook.createSheet(&quot;Clientes&quot;);</span>
<span class="fc" id="L218">            String[] headers = { &quot;Documento&quot;, &quot;Tipo&quot;, &quot;Razón Social / Nombre&quot;, &quot;Teléfono&quot;, &quot;Email&quot;, &quot;Dirección&quot;,</span>
                    &quot;Fecha Nacimiento&quot;,
                    &quot;Puntos Totales&quot;, &quot;Puntos Usados&quot;, &quot;Puntos Disponibles&quot; };
<span class="fc" id="L221">            short verdeA = IndexedColors.BRIGHT_GREEN.getIndex();</span>
            // Logo
<span class="fc" id="L223">            int logoRow = 0;</span>
            try {
<span class="fc" id="L225">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L226" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L227">                    byte[] bytes = is.readAllBytes();</span>
<span class="fc" id="L228">                    int pictureIdx = workbook.addPicture(bytes, Workbook.PICTURE_TYPE_PNG);</span>
<span class="fc" id="L229">                    org.apache.poi.ss.usermodel.Drawing&lt;?&gt; drawing = sheet.createDrawingPatriarch();</span>
<span class="fc" id="L230">                    org.apache.poi.ss.usermodel.ClientAnchor anchor = workbook.getCreationHelper().createClientAnchor();</span>
<span class="fc" id="L231">                    anchor.setCol1(0);</span>
<span class="fc" id="L232">                    anchor.setRow1(logoRow);</span>
<span class="fc" id="L233">                    anchor.setCol2(2);</span>
<span class="fc" id="L234">                    anchor.setRow2(logoRow + 3);</span>
<span class="fc" id="L235">                    drawing.createPicture(anchor, pictureIdx);</span>
<span class="fc" id="L236">                    logoRow = 3;</span>
                }
<span class="nc" id="L238">            } catch (Exception ex) {</span>
<span class="fc" id="L239">                /* Si falla, ignora el logo */ }</span>

            // Título
<span class="fc" id="L242">            Row titleRow = sheet.createRow(logoRow + 1);</span>
<span class="fc" id="L243">            Cell titleCell = titleRow.createCell(0);</span>
<span class="fc" id="L244">            titleCell.setCellValue(&quot;Listado de Clientes&quot;);</span>
<span class="fc" id="L245">            Font titleFont = workbook.createFont();</span>
<span class="fc" id="L246">            titleFont.setBold(true);</span>
<span class="fc" id="L247">            titleFont.setFontHeightInPoints((short) 18);</span>
<span class="fc" id="L248">            titleFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L249">            CellStyle titleStyle = workbook.createCellStyle();</span>
<span class="fc" id="L250">            titleStyle.setFont(titleFont);</span>
<span class="fc" id="L251">            titleStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L252">            titleStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L253">            titleStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L254">            titleCell.setCellStyle(titleStyle);</span>
<span class="fc" id="L255">            sheet.addMergedRegion(</span>
                    new org.apache.poi.ss.util.CellRangeAddress(logoRow + 1, logoRow + 1, 0, headers.length - 1));

            // Cabecera
<span class="fc" id="L259">            CellStyle headerStyle = workbook.createCellStyle();</span>
<span class="fc" id="L260">            headerStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L261">            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L262">            headerStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L263">            Font headerFont = workbook.createFont();</span>
<span class="fc" id="L264">            headerFont.setBold(true);</span>
<span class="fc" id="L265">            headerFont.setFontHeightInPoints((short) 14);</span>
<span class="fc" id="L266">            headerFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L267">            headerStyle.setFont(headerFont);</span>
<span class="fc" id="L268">            headerStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L269">            headerStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L270">            headerStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L271">            headerStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L273">            CellStyle cellStyle = workbook.createCellStyle();</span>
<span class="fc" id="L274">            cellStyle.setAlignment(HorizontalAlignment.LEFT);</span>
<span class="fc" id="L275">            cellStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L276">            cellStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L277">            cellStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L278">            cellStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L280">            Row header = sheet.createRow(logoRow + 2);</span>
<span class="fc bfc" id="L281" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L282">                Cell cell = header.createCell(i);</span>
<span class="fc" id="L283">                cell.setCellValue(headers[i]);</span>
<span class="fc" id="L284">                cell.setCellStyle(headerStyle);</span>
<span class="fc" id="L285">                sheet.setColumnWidth(i, 5000); // Ancho fijo para cada columna (ajustar si es necesario)</span>
            }
<span class="fc" id="L287">            header.setHeightInPoints(28); // Alto de la fila de encabezado</span>

<span class="fc" id="L289">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L290">            clientes.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente::getNombres,
<span class="fc" id="L292">                    java.text.Collator.getInstance()));</span>
<span class="fc bfc" id="L293" title="All 2 branches covered.">            for (int i = 0; i &lt; clientes.size(); i++) {</span>
<span class="fc" id="L294">                com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente c = clientes.get(i);</span>
<span class="fc" id="L295">                Row row = sheet.createRow(logoRow + 3 + i);</span>
<span class="pc bpc" id="L296" title="1 of 2 branches missed.">                row.createCell(0).setCellValue(c.getDocumento() != null ? c.getDocumento() : &quot;&quot;);</span>
<span class="pc bpc" id="L297" title="1 of 2 branches missed.">                row.createCell(1).setCellValue(c.getTipoCliente() != null ? c.getTipoCliente() : &quot;&quot;);</span>
<span class="fc" id="L298">                row.createCell(2).setCellValue(</span>
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">                        (&quot;EMPRESA&quot;.equals(c.getTipoCliente()) ? c.getRazonSocial() : c.getNombreCompleto()));</span>
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">                row.createCell(3).setCellValue(c.getTelefono() != null ? c.getTelefono() : &quot;&quot;);</span>
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">                row.createCell(4).setCellValue(c.getEmail() != null ? c.getEmail() : &quot;&quot;);</span>
<span class="pc bpc" id="L302" title="1 of 2 branches missed.">                row.createCell(5).setCellValue(c.getDireccion() != null ? c.getDireccion() : &quot;&quot;);</span>
<span class="fc" id="L303">                row.createCell(6)</span>
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">                        .setCellValue(c.getFechaNacimiento() != null ? c.getFechaNacimiento().format(fmt) : &quot;&quot;);</span>
<span class="pc bpc" id="L305" title="1 of 2 branches missed.">                row.createCell(7).setCellValue(c.getPuntosTotales() != null ? c.getPuntosTotales() : 0);</span>
<span class="pc bpc" id="L306" title="1 of 2 branches missed.">                row.createCell(8).setCellValue(c.getPuntosUsados() != null ? c.getPuntosUsados() : 0);</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">                row.createCell(9).setCellValue(c.getPuntosDisponibles() != null ? c.getPuntosDisponibles() : 0);</span>
                // Eliminada columna &quot;Frecuente&quot;
<span class="fc bfc" id="L309" title="All 2 branches covered.">                for (int j = 0; j &lt; headers.length; j++) {</span>
<span class="fc" id="L310">                    row.getCell(j).setCellStyle(cellStyle);</span>
                }
            }
<span class="fc bfc" id="L313" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L314">                sheet.autoSizeColumn(i);</span>
            }
            // Pie de página
<span class="fc" id="L317">            Row footer = sheet.createRow(logoRow + 3 + clientes.size() + 1);</span>
<span class="fc" id="L318">            Cell cellFooter = footer.createCell(0);</span>
<span class="fc" id="L319">            cellFooter.setCellValue(&quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt));</span>
<span class="fc" id="L320">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(footer.getRowNum(), footer.getRowNum(), 0,</span>
                    headers.length - 1));
<span class="fc" id="L322">            cellFooter.setCellStyle(cellStyle);</span>

<span class="fc" id="L324">            try (FileOutputStream fos = new FileOutputStream(nombreArchivo + &quot;.xlsx&quot;)) {</span>
<span class="fc" id="L325">                workbook.write(fos);</span>
            }
<span class="nc" id="L327">        } catch (IOException e) {</span>
<span class="nc" id="L328">            e.printStackTrace();</span>
<span class="fc" id="L329">        }</span>
<span class="fc" id="L330">    }</span>

    // Exportar clientes a PDF
    public static void exportarClientesPDF(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente&gt; clientes, String nombreArchivo) {
        try {
<span class="fc" id="L336">            com.itextpdf.text.Document document = new com.itextpdf.text.Document(</span>
<span class="fc" id="L337">                    com.itextpdf.text.PageSize.A4.rotate());</span>
<span class="fc" id="L338">            java.io.FileOutputStream fos = null;</span>
            try {
<span class="fc" id="L340">                fos = new java.io.FileOutputStream(nombreArchivo + &quot;.pdf&quot;);</span>
<span class="nc" id="L341">            } catch (java.io.FileNotFoundException fnfe) {</span>
<span class="nc" id="L342">                System.err.println(&quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;);</span>
<span class="nc" id="L343">                javax.swing.JOptionPane.showMessageDialog(null,</span>
                        &quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;,
                        &quot;Error de exportación&quot;, javax.swing.JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L346">                return;</span>
<span class="fc" id="L347">            }</span>
<span class="fc" id="L348">            com.itextpdf.text.pdf.PdfWriter.getInstance(document, fos);</span>
<span class="fc" id="L349">            document.open();</span>
            // Logo
            try {
<span class="fc" id="L352">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L353" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L354">                    com.itextpdf.text.Image logo = com.itextpdf.text.Image.getInstance(is.readAllBytes());</span>
<span class="fc" id="L355">                    logo.scaleToFit(120, 120);</span>
<span class="fc" id="L356">                    logo.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L357">                    document.add(logo);</span>
                }
<span class="nc" id="L359">            } catch (Exception ex) {</span>
<span class="fc" id="L360">                /* Si falla, ignora el logo */ }</span>

            // Título
<span class="fc" id="L363">            com.itextpdf.text.Font titleFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    18, com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L365">            com.itextpdf.text.Paragraph title = new com.itextpdf.text.Paragraph(&quot;Listado de Clientes&quot;, titleFont);</span>
<span class="fc" id="L366">            title.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L367">            document.add(title);</span>
<span class="fc" id="L368">            document.add(new com.itextpdf.text.Paragraph(&quot; &quot;));</span>

            // Tabla con cabecera estilizada
<span class="fc" id="L371">            String[] headers = { &quot;Documento&quot;, &quot;Tipo&quot;, &quot;Razón Social / Nombre&quot;, &quot;Teléfono&quot;, &quot;Email&quot;, &quot;Dirección&quot;,</span>
                    &quot;Fecha Nacimiento&quot;,
                    &quot;Puntos Totales&quot;, &quot;Puntos Usados&quot;, &quot;Puntos Disponibles&quot; };
<span class="fc" id="L374">            com.itextpdf.text.pdf.PdfPTable table = new com.itextpdf.text.pdf.PdfPTable(headers.length);</span>
<span class="fc" id="L375">            table.setWidthPercentage(100);</span>
<span class="fc" id="L376">            table.setSpacingBefore(10f);</span>
<span class="fc" id="L377">            table.setSpacingAfter(10f);</span>
            // table.setWidths(columnWidths); // Eliminado duplicado, solo dejar la nueva
            // declaración

<span class="fc" id="L381">            com.itextpdf.text.Font headerFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    9, com.itextpdf.text.Font.BOLD, com.itextpdf.text.BaseColor.WHITE);
<span class="fc" id="L383">            com.itextpdf.text.Font cellFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    11, com.itextpdf.text.Font.NORMAL, com.itextpdf.text.BaseColor.BLACK);

<span class="fc bfc" id="L386" title="All 2 branches covered.">            for (String h : headers) {</span>
<span class="fc" id="L387">                com.itextpdf.text.pdf.PdfPCell cell = new com.itextpdf.text.pdf.PdfPCell(</span>
                        new com.itextpdf.text.Phrase(h, headerFont));
<span class="fc" id="L389">                cell.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L390">                cell.setBackgroundColor(new com.itextpdf.text.BaseColor(40, 167, 69));</span>
<span class="fc" id="L391">                cell.setBorderColor(new com.itextpdf.text.BaseColor(32, 201, 151));</span>
<span class="fc" id="L392">                cell.setPadding(7f);</span>
<span class="fc" id="L393">                cell.setBorderWidth(1.5f);</span>
<span class="fc" id="L394">                cell.setNoWrap(true); // Evita el wrap vertical</span>
<span class="fc" id="L395">                cell.setFixedHeight(28f); // Alto fijo para la celda de encabezado</span>
<span class="fc" id="L396">                table.addCell(cell);</span>
            }

<span class="fc" id="L399">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L400">            clientes.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente::getNombres,
<span class="fc" id="L402">                    java.text.Collator.getInstance()));</span>
<span class="fc bfc" id="L403" title="All 2 branches covered.">            for (com.farmaciavictoria.proyectopharmavictoria.model.Cliente.Cliente c : clientes) {</span>
<span class="pc bpc" id="L404" title="1 of 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(c.getDocumento() != null ? c.getDocumento() : &quot;&quot;, cellFont));</span>
<span class="fc" id="L405">                table.addCell(</span>
<span class="pc bpc" id="L406" title="1 of 2 branches missed.">                        new com.itextpdf.text.Phrase(c.getTipoCliente() != null ? c.getTipoCliente() : &quot;&quot;, cellFont));</span>
<span class="fc" id="L407">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="pc bpc" id="L408" title="1 of 2 branches missed.">                        (&quot;EMPRESA&quot;.equals(c.getTipoCliente()) ? c.getRazonSocial() : c.getNombreCompleto()),</span>
                        cellFont));
<span class="pc bpc" id="L410" title="1 of 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(c.getTelefono() != null ? c.getTelefono() : &quot;&quot;, cellFont));</span>
<span class="pc bpc" id="L411" title="1 of 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(c.getEmail() != null ? c.getEmail() : &quot;&quot;, cellFont));</span>
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(c.getDireccion() != null ? c.getDireccion() : &quot;&quot;, cellFont));</span>
<span class="fc" id="L413">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="pc bpc" id="L414" title="1 of 2 branches missed.">                        c.getFechaNacimiento() != null ? c.getFechaNacimiento().format(fmt) : &quot;&quot;, cellFont));</span>
<span class="fc" id="L415">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">                        c.getPuntosTotales() != null ? c.getPuntosTotales().toString() : &quot;0&quot;, cellFont));</span>
<span class="fc" id="L417">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="pc bpc" id="L418" title="1 of 2 branches missed.">                        c.getPuntosUsados() != null ? c.getPuntosUsados().toString() : &quot;0&quot;, cellFont));</span>
<span class="fc" id="L419">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="pc bpc" id="L420" title="1 of 2 branches missed.">                        c.getPuntosDisponibles() != null ? c.getPuntosDisponibles().toString() : &quot;0&quot;, cellFont));</span>
                // Eliminada columna &quot;Frecuente&quot;
<span class="fc" id="L422">            }</span>
<span class="fc" id="L423">            document.add(table);</span>
<span class="fc" id="L424">            float[] columnWidths = { 1.5f, 2f, 1.5f, 1.5f, 2f, 2f, 1.3f, 1.3f, 1.3f, 1.3f, 1.2f };</span>
<span class="fc" id="L425">            com.itextpdf.text.Paragraph footer = new com.itextpdf.text.Paragraph(</span>
<span class="fc" id="L426">                    &quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt), cellFont);</span>
<span class="fc" id="L427">            footer.setAlignment(com.itextpdf.text.Element.ALIGN_RIGHT);</span>
<span class="fc" id="L428">            document.add(footer);</span>
<span class="fc" id="L429">            document.close();</span>
<span class="nc" id="L430">        } catch (Exception e) {</span>
<span class="nc" id="L431">            e.printStackTrace();</span>
<span class="fc" id="L432">        }</span>
<span class="fc" id="L433">    }</span>

    public static void exportarProveedoresExcel(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor&gt; proveedores,
            String nombreArchivo) {
<span class="fc" id="L438">        try (Workbook workbook = new XSSFWorkbook()) {</span>
<span class="fc" id="L439">            Sheet sheet = workbook.createSheet(&quot;Proveedores&quot;);</span>
<span class="fc" id="L440">            String[] headers = { &quot;Razón Social&quot;, &quot;RUC&quot;, &quot;Contacto&quot;, &quot;Teléfono&quot;, &quot;Condiciones Pago&quot;, &quot;Estado&quot; };</span>
<span class="fc" id="L441">            short verdeA = IndexedColors.BRIGHT_GREEN.getIndex();</span>
            // Logo
<span class="fc" id="L443">            int logoRow = 0;</span>
            try {
<span class="fc" id="L445">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L446" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L447">                    byte[] bytes = is.readAllBytes();</span>
<span class="fc" id="L448">                    int pictureIdx = workbook.addPicture(bytes, Workbook.PICTURE_TYPE_PNG);</span>
<span class="fc" id="L449">                    org.apache.poi.ss.usermodel.Drawing&lt;?&gt; drawing = sheet.createDrawingPatriarch();</span>
<span class="fc" id="L450">                    org.apache.poi.ss.usermodel.ClientAnchor anchor = workbook.getCreationHelper().createClientAnchor();</span>
<span class="fc" id="L451">                    anchor.setCol1(0);</span>
<span class="fc" id="L452">                    anchor.setRow1(logoRow);</span>
<span class="fc" id="L453">                    anchor.setCol2(2);</span>
<span class="fc" id="L454">                    anchor.setRow2(logoRow + 3);</span>
<span class="fc" id="L455">                    drawing.createPicture(anchor, pictureIdx);</span>
<span class="fc" id="L456">                    logoRow = 3;</span>
                }
<span class="nc" id="L458">            } catch (Exception ex) {</span>
<span class="fc" id="L459">                /* Si falla, ignora el logo */ }</span>

            // RUC
<span class="fc" id="L462">            Row rucRow = sheet.createRow(logoRow);</span>
<span class="fc" id="L463">            Cell rucCell = rucRow.createCell(0);</span>
<span class="fc" id="L464">            rucCell.setCellValue(&quot;RUC: 10468894501&quot;);</span>
<span class="fc" id="L465">            Font rucFont = workbook.createFont();</span>
<span class="fc" id="L466">            rucFont.setBold(true);</span>
<span class="fc" id="L467">            rucFont.setColor(IndexedColors.DARK_GREEN.getIndex());</span>
<span class="fc" id="L468">            CellStyle rucStyle = workbook.createCellStyle();</span>
<span class="fc" id="L469">            rucStyle.setFont(rucFont);</span>
<span class="fc" id="L470">            rucStyle.setAlignment(HorizontalAlignment.LEFT);</span>
<span class="fc" id="L471">            rucCell.setCellStyle(rucStyle);</span>
<span class="fc" id="L472">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(logoRow, logoRow, 0, headers.length - 1));</span>

            // Título
<span class="fc" id="L475">            Row titleRow = sheet.createRow(logoRow + 1);</span>
<span class="fc" id="L476">            Cell titleCell = titleRow.createCell(0);</span>
<span class="fc" id="L477">            titleCell.setCellValue(&quot;Listado de Proveedores&quot;);</span>
<span class="fc" id="L478">            Font titleFont = workbook.createFont();</span>
<span class="fc" id="L479">            titleFont.setBold(true);</span>
<span class="fc" id="L480">            titleFont.setFontHeightInPoints((short) 18);</span>
<span class="fc" id="L481">            titleFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L482">            CellStyle titleStyle = workbook.createCellStyle();</span>
<span class="fc" id="L483">            titleStyle.setFont(titleFont);</span>
<span class="fc" id="L484">            titleStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L485">            titleStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L486">            titleStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L487">            titleCell.setCellStyle(titleStyle);</span>
<span class="fc" id="L488">            sheet.addMergedRegion(</span>
                    new org.apache.poi.ss.util.CellRangeAddress(logoRow + 1, logoRow + 1, 0, headers.length - 1));

            // Cabecera
<span class="fc" id="L492">            CellStyle headerStyle = workbook.createCellStyle();</span>
<span class="fc" id="L493">            headerStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L494">            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L495">            headerStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L496">            Font headerFont = workbook.createFont();</span>
<span class="fc" id="L497">            headerFont.setBold(true);</span>
<span class="fc" id="L498">            headerFont.setFontHeightInPoints((short) 14);</span>
<span class="fc" id="L499">            headerFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L500">            headerStyle.setFont(headerFont);</span>
<span class="fc" id="L501">            headerStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L502">            headerStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L503">            headerStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L504">            headerStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L506">            CellStyle cellStyle = workbook.createCellStyle();</span>
<span class="fc" id="L507">            cellStyle.setAlignment(HorizontalAlignment.LEFT);</span>
<span class="fc" id="L508">            cellStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L509">            cellStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L510">            cellStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L511">            cellStyle.setBorderRight(BorderStyle.THIN);</span>

<span class="fc" id="L513">            Row header = sheet.createRow(logoRow + 2);</span>
<span class="fc bfc" id="L514" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L515">                Cell cell = header.createCell(i);</span>
<span class="fc" id="L516">                cell.setCellValue(headers[i]);</span>
<span class="fc" id="L517">                cell.setCellStyle(headerStyle);</span>
            }

            // Ordenar por razón social
<span class="fc" id="L521">            proveedores.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor::getRazonSocial,
<span class="fc" id="L523">                    java.text.Collator.getInstance()));</span>

<span class="pc bpc" id="L525" title="1 of 2 branches missed.">            for (int i = 0; i &lt; proveedores.size(); i++) {</span>
<span class="nc" id="L526">                com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor p = proveedores.get(i);</span>
<span class="nc" id="L527">                Row row = sheet.createRow(logoRow + 3 + i);</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">                row.createCell(0).setCellValue(p.getRazonSocial() != null ? p.getRazonSocial() : &quot;&quot;);</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">                row.createCell(1).setCellValue(p.getRuc() != null ? p.getRuc() : &quot;&quot;);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">                row.createCell(2).setCellValue(p.getContacto() != null ? p.getContacto() : &quot;&quot;);</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">                row.createCell(3).setCellValue(p.getTelefono() != null ? p.getTelefono() : &quot;&quot;);</span>
<span class="nc bnc" id="L532" title="All 2 branches missed.">                row.createCell(4).setCellValue(p.getCondicionesPago() != null ? p.getCondicionesPago() : &quot;&quot;);</span>
<span class="nc bnc" id="L533" title="All 4 branches missed.">                row.createCell(5).setCellValue(p.getActivo() != null &amp;&amp; p.getActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;);</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">                for (int j = 0; j &lt; headers.length; j++) {</span>
<span class="nc" id="L535">                    row.getCell(j).setCellStyle(cellStyle);</span>
                }
            }
<span class="fc bfc" id="L538" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L539">                sheet.autoSizeColumn(i);</span>
            }
            // Pie de página
<span class="fc" id="L542">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L543">            Row footer = sheet.createRow(logoRow + 3 + proveedores.size() + 1);</span>
<span class="fc" id="L544">            Cell cellFooter = footer.createCell(0);</span>
<span class="fc" id="L545">            cellFooter.setCellValue(&quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt));</span>
<span class="fc" id="L546">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(footer.getRowNum(), footer.getRowNum(), 0,</span>
                    headers.length - 1));
<span class="fc" id="L548">            cellFooter.setCellStyle(cellStyle);</span>

<span class="fc" id="L550">            try (FileOutputStream fos = new FileOutputStream(nombreArchivo + &quot;.xlsx&quot;)) {</span>
<span class="fc" id="L551">                workbook.write(fos);</span>
            }
<span class="nc" id="L553">        } catch (IOException e) {</span>
<span class="nc" id="L554">            e.printStackTrace();</span>
<span class="fc" id="L555">        }</span>
<span class="fc" id="L556">    }</span>

    public static void exportarProveedoresPDF(
            List&lt;com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor&gt; proveedores,
            String nombreArchivo) {
        try {
<span class="fc" id="L562">            com.itextpdf.text.Document document = new com.itextpdf.text.Document();</span>
<span class="fc" id="L563">            java.io.FileOutputStream fos = null;</span>
            try {
<span class="fc" id="L565">                fos = new java.io.FileOutputStream(nombreArchivo + &quot;.pdf&quot;);</span>
<span class="nc" id="L566">            } catch (java.io.FileNotFoundException fnfe) {</span>
<span class="nc" id="L567">                System.err.println(&quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;);</span>
<span class="nc" id="L568">                javax.swing.JOptionPane.showMessageDialog(null,</span>
                        &quot;No se pudo crear el PDF. El archivo está abierto o bloqueado por otra aplicación.&quot;,
                        &quot;Error de exportación&quot;, javax.swing.JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L571">                return;</span>
<span class="fc" id="L572">            }</span>
<span class="fc" id="L573">            com.itextpdf.text.pdf.PdfWriter.getInstance(document, fos);</span>
<span class="fc" id="L574">            document.open();</span>
            // Logo
            try {
<span class="fc" id="L577">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L578" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L579">                    com.itextpdf.text.Image logo = com.itextpdf.text.Image.getInstance(is.readAllBytes());</span>
<span class="fc" id="L580">                    logo.scaleToFit(120, 120);</span>
<span class="fc" id="L581">                    logo.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L582">                    document.add(logo);</span>
                }
<span class="nc" id="L584">            } catch (Exception ex) {</span>
<span class="fc" id="L585">                /* Si falla, ignora el logo */ }</span>

            // RUC
<span class="fc" id="L588">            com.itextpdf.text.Font rucFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA, 12,</span>
                    com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L590">            com.itextpdf.text.Paragraph ruc = new com.itextpdf.text.Paragraph(&quot;RUC: 10468894501&quot;, rucFont);</span>
<span class="fc" id="L591">            ruc.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L592">            document.add(ruc);</span>

            // Título
<span class="fc" id="L595">            com.itextpdf.text.Font titleFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    18, com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L597">            com.itextpdf.text.Paragraph title = new com.itextpdf.text.Paragraph(&quot;Listado de Proveedores&quot;, titleFont);</span>
<span class="fc" id="L598">            title.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L599">            document.add(title);</span>
<span class="fc" id="L600">            document.add(new com.itextpdf.text.Paragraph(&quot; &quot;));</span>

            // Tabla con cabecera estilizada
<span class="fc" id="L603">            String[] headers = { &quot;Razón Social&quot;, &quot;RUC&quot;, &quot;Contacto&quot;, &quot;Teléfono&quot;, &quot;Condiciones Pago&quot;, &quot;Estado&quot; };</span>
<span class="fc" id="L604">            com.itextpdf.text.pdf.PdfPTable table = new com.itextpdf.text.pdf.PdfPTable(headers.length);</span>
<span class="fc" id="L605">            table.setWidthPercentage(100);</span>
<span class="fc" id="L606">            table.setSpacingBefore(10f);</span>
<span class="fc" id="L607">            table.setSpacingAfter(10f);</span>
<span class="fc" id="L608">            float[] columnWidths = { 2.5f, 1.5f, 1.5f, 1.5f, 2f, 1.5f };</span>
<span class="fc" id="L609">            table.setWidths(columnWidths);</span>

<span class="fc" id="L611">            com.itextpdf.text.Font headerFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    13, com.itextpdf.text.Font.BOLD, com.itextpdf.text.BaseColor.WHITE);
<span class="fc" id="L613">            com.itextpdf.text.Font cellFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    11, com.itextpdf.text.Font.NORMAL, com.itextpdf.text.BaseColor.BLACK);

<span class="fc bfc" id="L616" title="All 2 branches covered.">            for (String h : headers) {</span>
<span class="fc" id="L617">                com.itextpdf.text.pdf.PdfPCell cell = new com.itextpdf.text.pdf.PdfPCell(</span>
                        new com.itextpdf.text.Phrase(h, headerFont));
<span class="fc" id="L619">                cell.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L620">                cell.setBackgroundColor(new com.itextpdf.text.BaseColor(40, 167, 69));</span>
<span class="fc" id="L621">                cell.setBorderColor(new com.itextpdf.text.BaseColor(32, 201, 151));</span>
<span class="fc" id="L622">                cell.setPadding(7f);</span>
<span class="fc" id="L623">                cell.setBorderWidth(1.5f);</span>
<span class="fc" id="L624">                table.addCell(cell);</span>
            }

            // Ordenar por razón social
<span class="fc" id="L628">            proveedores.sort(java.util.Comparator.comparing(</span>
                    com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor::getRazonSocial,
<span class="fc" id="L630">                    java.text.Collator.getInstance()));</span>

<span class="pc bpc" id="L632" title="1 of 2 branches missed.">            for (com.farmaciavictoria.proyectopharmavictoria.model.Proveedor.Proveedor p : proveedores) {</span>
<span class="nc" id="L633">                table.addCell(</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">                        new com.itextpdf.text.Phrase(p.getRazonSocial() != null ? p.getRazonSocial() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(p.getRuc() != null ? p.getRuc() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(p.getContacto() != null ? p.getContacto() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(p.getTelefono() != null ? p.getTelefono() : &quot;&quot;, cellFont));</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">                table.addCell(new com.itextpdf.text.Phrase(p.getCondicionesPago() != null ? p.getCondicionesPago() : &quot;&quot;,</span>
                        cellFont));
<span class="nc" id="L640">                table.addCell(new com.itextpdf.text.Phrase(</span>
<span class="nc bnc" id="L641" title="All 4 branches missed.">                        p.getActivo() != null &amp;&amp; p.getActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;, cellFont));</span>
<span class="nc" id="L642">            }</span>
<span class="fc" id="L643">            document.add(table);</span>
            // Pie de página
<span class="fc" id="L645">            java.time.format.DateTimeFormatter fmt = java.time.format.DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L646">            com.itextpdf.text.Paragraph footer = new com.itextpdf.text.Paragraph(</span>
<span class="fc" id="L647">                    &quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt), cellFont);</span>
<span class="fc" id="L648">            footer.setAlignment(com.itextpdf.text.Element.ALIGN_RIGHT);</span>
<span class="fc" id="L649">            document.add(footer);</span>
<span class="fc" id="L650">            document.close();</span>
<span class="nc" id="L651">        } catch (Exception e) {</span>
<span class="nc" id="L652">            e.printStackTrace();</span>
<span class="fc" id="L653">        }</span>
<span class="fc" id="L654">    }</span>

    public static void exportarExcel(List&lt;Producto&gt; productos, String nombreArchivo) {
<span class="fc" id="L657">        try (Workbook workbook = new XSSFWorkbook()) {</span>
<span class="fc" id="L658">            Sheet sheet = workbook.createSheet(&quot;Inventario&quot;);</span>
<span class="fc" id="L659">            String[] headers = { &quot;Código&quot;, &quot;Nombre&quot;, &quot;Precio S/&quot;, &quot;Stock&quot;, &quot;Vencimiento&quot;, &quot;Estado&quot; };</span>
            // Colores corporativos
<span class="fc" id="L661">            short verdeA = IndexedColors.BRIGHT_GREEN.getIndex();</span>
<span class="fc" id="L662">            short verdeB = IndexedColors.LIGHT_GREEN.getIndex();</span>
            // Estilo para cabecera
<span class="fc" id="L664">            CellStyle headerStyle = workbook.createCellStyle();</span>
<span class="fc" id="L665">            headerStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L666">            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L667">            headerStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L668">            Font headerFont = workbook.createFont();</span>
<span class="fc" id="L669">            headerFont.setBold(true);</span>
<span class="fc" id="L670">            headerFont.setFontHeightInPoints((short) 14);</span>
<span class="fc" id="L671">            headerFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L672">            headerStyle.setFont(headerFont);</span>
<span class="fc" id="L673">            headerStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L674">            headerStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L675">            headerStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L676">            headerStyle.setBorderRight(BorderStyle.THIN);</span>

            // Estilo para celdas normales
<span class="fc" id="L679">            CellStyle cellStyle = workbook.createCellStyle();</span>
<span class="fc" id="L680">            cellStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L681">            cellStyle.setBorderBottom(BorderStyle.THIN);</span>
<span class="fc" id="L682">            cellStyle.setBorderTop(BorderStyle.THIN);</span>
<span class="fc" id="L683">            cellStyle.setBorderLeft(BorderStyle.THIN);</span>
<span class="fc" id="L684">            cellStyle.setBorderRight(BorderStyle.THIN);</span>

            // Logo y RUC
<span class="fc" id="L687">            int logoRow = 0;</span>
            try {
<span class="fc" id="L689">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L690" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L691">                    byte[] bytes = is.readAllBytes();</span>
<span class="fc" id="L692">                    int pictureIdx = workbook.addPicture(bytes, Workbook.PICTURE_TYPE_PNG);</span>
<span class="fc" id="L693">                    org.apache.poi.ss.usermodel.Drawing&lt;?&gt; drawing = sheet.createDrawingPatriarch();</span>
<span class="fc" id="L694">                    org.apache.poi.ss.usermodel.ClientAnchor anchor = workbook.getCreationHelper().createClientAnchor();</span>
<span class="fc" id="L695">                    anchor.setCol1(0);</span>
<span class="fc" id="L696">                    anchor.setRow1(logoRow);</span>
<span class="fc" id="L697">                    anchor.setCol2(2);</span>
<span class="fc" id="L698">                    anchor.setRow2(logoRow + 3);</span>
<span class="fc" id="L699">                    drawing.createPicture(anchor, pictureIdx);</span>
<span class="fc" id="L700">                    logoRow = 3;</span>
                }
<span class="nc" id="L702">            } catch (Exception ex) {</span>
<span class="fc" id="L703">                /* Si falla, ignora el logo */ }</span>

            // RUC
<span class="fc" id="L706">            Row rucRow = sheet.createRow(logoRow);</span>
<span class="fc" id="L707">            Cell rucCell = rucRow.createCell(0);</span>
<span class="fc" id="L708">            rucCell.setCellValue(&quot;RUC: 10468894501&quot;);</span>
<span class="fc" id="L709">            Font rucFont = workbook.createFont();</span>
<span class="fc" id="L710">            rucFont.setBold(true);</span>
<span class="fc" id="L711">            rucFont.setColor(IndexedColors.DARK_GREEN.getIndex());</span>
<span class="fc" id="L712">            CellStyle rucStyle = workbook.createCellStyle();</span>
<span class="fc" id="L713">            rucStyle.setFont(rucFont);</span>
<span class="fc" id="L714">            rucStyle.setAlignment(HorizontalAlignment.LEFT);</span>
<span class="fc" id="L715">            rucCell.setCellStyle(rucStyle);</span>
<span class="fc" id="L716">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(logoRow, logoRow, 0, headers.length - 1));</span>

            // Título
<span class="fc" id="L719">            Row titleRow = sheet.createRow(logoRow + 1);</span>
<span class="fc" id="L720">            Cell titleCell = titleRow.createCell(0);</span>
<span class="fc" id="L721">            titleCell.setCellValue(&quot;Inventario de Productos&quot;);</span>
<span class="fc" id="L722">            Font titleFont = workbook.createFont();</span>
<span class="fc" id="L723">            titleFont.setBold(true);</span>
<span class="fc" id="L724">            titleFont.setFontHeightInPoints((short) 18);</span>
<span class="fc" id="L725">            titleFont.setColor(IndexedColors.WHITE.getIndex());</span>
<span class="fc" id="L726">            CellStyle titleStyle = workbook.createCellStyle();</span>
<span class="fc" id="L727">            titleStyle.setFont(titleFont);</span>
<span class="fc" id="L728">            titleStyle.setAlignment(HorizontalAlignment.CENTER);</span>
<span class="fc" id="L729">            titleStyle.setFillForegroundColor(verdeA);</span>
<span class="fc" id="L730">            titleStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);</span>
<span class="fc" id="L731">            titleCell.setCellStyle(titleStyle);</span>
<span class="fc" id="L732">            sheet.addMergedRegion(</span>
                    new org.apache.poi.ss.util.CellRangeAddress(logoRow + 1, logoRow + 1, 0, headers.length - 1));

            // Cabecera
<span class="fc" id="L736">            Row header = sheet.createRow(logoRow + 2);</span>
<span class="fc bfc" id="L737" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L738">                Cell cell = header.createCell(i);</span>
<span class="fc" id="L739">                cell.setCellValue(headers[i]);</span>
<span class="fc" id="L740">                cell.setCellStyle(headerStyle);</span>
            }
<span class="fc" id="L742">            DateTimeFormatter fmt = DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L743">            productos.sort(java.util.Comparator.comparing(Producto::getNombre, java.text.Collator.getInstance()));</span>
<span class="pc bpc" id="L744" title="1 of 2 branches missed.">            for (int i = 0; i &lt; productos.size(); i++) {</span>
<span class="nc" id="L745">                Producto p = productos.get(i);</span>
<span class="nc" id="L746">                Row row = sheet.createRow(logoRow + 3 + i);</span>
<span class="nc" id="L747">                Cell c0 = row.createCell(0);</span>
<span class="nc" id="L748">                c0.setCellValue(p.getCodigo());</span>
<span class="nc" id="L749">                c0.setCellStyle(cellStyle);</span>
<span class="nc" id="L750">                Cell c1 = row.createCell(1);</span>
<span class="nc" id="L751">                c1.setCellValue(p.getNombre());</span>
<span class="nc" id="L752">                c1.setCellStyle(cellStyle);</span>
<span class="nc" id="L753">                Cell c2 = row.createCell(2);</span>
<span class="nc" id="L754">                c2.setCellValue(p.getPrecioVenta().doubleValue());</span>
<span class="nc" id="L755">                c2.setCellStyle(cellStyle);</span>
<span class="nc" id="L756">                Cell c3 = row.createCell(3);</span>
<span class="nc" id="L757">                c3.setCellValue(p.getStockActual());</span>
<span class="nc" id="L758">                c3.setCellStyle(cellStyle);</span>
<span class="nc" id="L759">                Cell c4 = row.createCell(4);</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">                c4.setCellValue(p.getFechaVencimiento() != null ? p.getFechaVencimiento().format(fmt) : &quot;&quot;);</span>
<span class="nc" id="L761">                c4.setCellStyle(cellStyle);</span>
<span class="nc" id="L762">                Cell c5 = row.createCell(5);</span>
<span class="nc bnc" id="L763" title="All 2 branches missed.">                c5.setCellValue(p.getActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;);</span>
<span class="nc" id="L764">                c5.setCellStyle(cellStyle);</span>
            }
<span class="fc bfc" id="L766" title="All 2 branches covered.">            for (int i = 0; i &lt; headers.length; i++) {</span>
<span class="fc" id="L767">                sheet.autoSizeColumn(i);</span>
            }
            // Pie de página
<span class="fc" id="L770">            Row footer = sheet.createRow(logoRow + 3 + productos.size() + 1);</span>
<span class="fc" id="L771">            Cell cellFooter = footer.createCell(0);</span>
<span class="fc" id="L772">            cellFooter.setCellValue(&quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt));</span>
<span class="fc" id="L773">            sheet.addMergedRegion(new org.apache.poi.ss.util.CellRangeAddress(footer.getRowNum(), footer.getRowNum(), 0,</span>
                    headers.length - 1));
<span class="fc" id="L775">            cellFooter.setCellStyle(cellStyle);</span>

<span class="fc" id="L777">            try (FileOutputStream fos = new FileOutputStream(nombreArchivo + &quot;.xlsx&quot;)) {</span>
<span class="fc" id="L778">                workbook.write(fos);</span>
            }
<span class="nc" id="L780">        } catch (IOException e) {</span>
<span class="nc" id="L781">            e.printStackTrace();</span>
<span class="fc" id="L782">        }</span>
<span class="fc" id="L783">    }</span>

    public static void exportarPDF(List&lt;Producto&gt; productos, String nombreArchivo) {
        // Implementación funcional usando iText con logo, RUC y formato moderno
        try {
<span class="fc" id="L788">            com.itextpdf.text.Document document = new com.itextpdf.text.Document();</span>
<span class="fc" id="L789">            com.itextpdf.text.pdf.PdfWriter.getInstance(document, new java.io.FileOutputStream(nombreArchivo + &quot;.pdf&quot;));</span>
<span class="fc" id="L790">            document.open();</span>
            // Logo
            try {
<span class="fc" id="L793">                java.io.InputStream is = ExportFacade.class.getResourceAsStream(&quot;/icons/logofarmacia.png&quot;);</span>
<span class="pc bpc" id="L794" title="1 of 2 branches missed.">                if (is != null) {</span>
<span class="fc" id="L795">                    com.itextpdf.text.Image logo = com.itextpdf.text.Image.getInstance(is.readAllBytes());</span>
<span class="fc" id="L796">                    logo.scaleToFit(120, 120);</span>
<span class="fc" id="L797">                    logo.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L798">                    document.add(logo);</span>
                }
<span class="nc" id="L800">            } catch (Exception ex) {</span>
<span class="fc" id="L801">                /* Si falla, ignora el logo */ }</span>

            // RUC
<span class="fc" id="L804">            com.itextpdf.text.Font rucFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA, 12,</span>
                    com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L806">            com.itextpdf.text.Paragraph ruc = new com.itextpdf.text.Paragraph(&quot;RUC: 10468894501&quot;, rucFont);</span>
<span class="fc" id="L807">            ruc.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L808">            document.add(ruc);</span>

            // Título
<span class="fc" id="L811">            com.itextpdf.text.Font titleFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    18, com.itextpdf.text.Font.BOLD, new com.itextpdf.text.BaseColor(40, 167, 69));
<span class="fc" id="L813">            com.itextpdf.text.Paragraph title = new com.itextpdf.text.Paragraph(&quot;Inventario de Productos&quot;, titleFont);</span>
<span class="fc" id="L814">            title.setAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L815">            document.add(title);</span>
<span class="fc" id="L816">            document.add(new com.itextpdf.text.Paragraph(&quot; &quot;));</span>

            // Tabla con cabecera estilizada
<span class="fc" id="L819">            com.itextpdf.text.pdf.PdfPTable table = new com.itextpdf.text.pdf.PdfPTable(6);</span>
<span class="fc" id="L820">            table.setWidthPercentage(100);</span>
<span class="fc" id="L821">            table.setSpacingBefore(10f);</span>
<span class="fc" id="L822">            table.setSpacingAfter(10f);</span>
<span class="fc" id="L823">            float[] columnWidths = { 1.5f, 3f, 1.5f, 1.5f, 2f, 1.5f };</span>
<span class="fc" id="L824">            table.setWidths(columnWidths);</span>

<span class="fc" id="L826">            com.itextpdf.text.Font headerFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    13, com.itextpdf.text.Font.BOLD, com.itextpdf.text.BaseColor.WHITE);
<span class="fc" id="L828">            com.itextpdf.text.Font cellFont = new com.itextpdf.text.Font(com.itextpdf.text.Font.FontFamily.HELVETICA,</span>
                    11, com.itextpdf.text.Font.NORMAL, com.itextpdf.text.BaseColor.BLACK);

<span class="fc" id="L831">            int verdeEncabezado = new com.itextpdf.text.BaseColor(40, 167, 69).getRGB();</span>
<span class="fc" id="L832">            String[] headers = { &quot;Código&quot;, &quot;Nombre&quot;, &quot;Precio S/&quot;, &quot;Stock&quot;, &quot;Vencimiento&quot;, &quot;Estado&quot; };</span>
<span class="fc bfc" id="L833" title="All 2 branches covered.">            for (String h : headers) {</span>
<span class="fc" id="L834">                com.itextpdf.text.pdf.PdfPCell cell = new com.itextpdf.text.pdf.PdfPCell(</span>
                        new com.itextpdf.text.Phrase(h, headerFont));
<span class="fc" id="L836">                cell.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="fc" id="L837">                cell.setBackgroundColor(new com.itextpdf.text.BaseColor(40, 167, 69));</span>
<span class="fc" id="L838">                cell.setBorderColor(new com.itextpdf.text.BaseColor(32, 201, 151));</span>
<span class="fc" id="L839">                cell.setPadding(7f);</span>
<span class="fc" id="L840">                cell.setBorderWidth(1.5f);</span>
<span class="fc" id="L841">                table.addCell(cell);</span>
            }
<span class="fc" id="L843">            DateTimeFormatter fmt = DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);</span>
<span class="fc" id="L844">            productos.sort(java.util.Comparator.comparing(Producto::getNombre, java.text.Collator.getInstance()));</span>
<span class="pc bpc" id="L845" title="1 of 2 branches missed.">            for (Producto p : productos) {</span>
<span class="nc" id="L846">                com.itextpdf.text.pdf.PdfPCell c0 = new com.itextpdf.text.pdf.PdfPCell(</span>
<span class="nc" id="L847">                        new com.itextpdf.text.Phrase(p.getCodigo(), cellFont));</span>
<span class="nc" id="L848">                com.itextpdf.text.pdf.PdfPCell c1 = new com.itextpdf.text.pdf.PdfPCell(</span>
<span class="nc" id="L849">                        new com.itextpdf.text.Phrase(p.getNombre(), cellFont));</span>
<span class="nc" id="L850">                com.itextpdf.text.pdf.PdfPCell c2 = new com.itextpdf.text.pdf.PdfPCell(</span>
<span class="nc" id="L851">                        new com.itextpdf.text.Phrase(String.valueOf(p.getPrecioVenta()), cellFont));</span>
<span class="nc" id="L852">                com.itextpdf.text.pdf.PdfPCell c3 = new com.itextpdf.text.pdf.PdfPCell(</span>
<span class="nc" id="L853">                        new com.itextpdf.text.Phrase(String.valueOf(p.getStockActual()), cellFont));</span>
<span class="nc" id="L854">                com.itextpdf.text.pdf.PdfPCell c4 = new com.itextpdf.text.pdf.PdfPCell(new com.itextpdf.text.Phrase(</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">                        p.getFechaVencimiento() != null ? p.getFechaVencimiento().format(fmt) : &quot;&quot;, cellFont));</span>
<span class="nc" id="L856">                com.itextpdf.text.pdf.PdfPCell c5 = new com.itextpdf.text.pdf.PdfPCell(</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">                        new com.itextpdf.text.Phrase(p.getActivo() ? &quot;Activo&quot; : &quot;Inactivo&quot;, cellFont));</span>
<span class="nc" id="L858">                c0.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="nc" id="L859">                c1.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_LEFT);</span>
<span class="nc" id="L860">                c2.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="nc" id="L861">                c3.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="nc" id="L862">                c4.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="nc" id="L863">                c5.setHorizontalAlignment(com.itextpdf.text.Element.ALIGN_CENTER);</span>
<span class="nc" id="L864">                c0.setPadding(5f);</span>
<span class="nc" id="L865">                c1.setPadding(5f);</span>
<span class="nc" id="L866">                c2.setPadding(5f);</span>
<span class="nc" id="L867">                c3.setPadding(5f);</span>
<span class="nc" id="L868">                c4.setPadding(5f);</span>
<span class="nc" id="L869">                c5.setPadding(5f);</span>
<span class="nc" id="L870">                table.addCell(c0);</span>
<span class="nc" id="L871">                table.addCell(c1);</span>
<span class="nc" id="L872">                table.addCell(c2);</span>
<span class="nc" id="L873">                table.addCell(c3);</span>
<span class="nc" id="L874">                table.addCell(c4);</span>
<span class="nc" id="L875">                table.addCell(c5);</span>
<span class="nc" id="L876">            }</span>
<span class="fc" id="L877">            document.add(table);</span>
            // Pie de página
<span class="fc" id="L879">            com.itextpdf.text.Paragraph footer = new com.itextpdf.text.Paragraph(</span>
<span class="fc" id="L880">                    &quot;Exportado el: &quot; + java.time.LocalDate.now().format(fmt), cellFont);</span>
<span class="fc" id="L881">            footer.setAlignment(com.itextpdf.text.Element.ALIGN_RIGHT);</span>
<span class="fc" id="L882">            document.add(footer);</span>
<span class="fc" id="L883">            document.close();</span>
<span class="nc" id="L884">        } catch (Exception e) {</span>
<span class="nc" id="L885">            e.printStackTrace();</span>
<span class="fc" id="L886">        }</span>
<span class="fc" id="L887">    }</span>

    // Exportar ventas usando Factory para reportes avanzados
    public static void exportarReporteVentasAvanzado(String tipo,
            java.util.List&lt;com.farmaciavictoria.proyectopharmavictoria.controller.reportes.dto.VentaReporteDTO&gt; ventas,
            String nombreArchivo) {
<span class="nc" id="L893">        com.farmaciavictoria.proyectopharmavictoria.controller.reportes.export.ExportadorReporte exportador = com.farmaciavictoria.proyectopharmavictoria.controller.reportes.export.ExportadorReporteFactory</span>
<span class="nc" id="L894">                .getExportador(tipo, ReporteTipo.VENTAS);</span>
<span class="nc" id="L895">        exportador.exportar(ventas, new File(nombreArchivo));</span>
<span class="nc" id="L896">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>