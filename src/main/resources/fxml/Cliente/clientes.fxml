<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>

<ScrollPane fitToWidth="true" fitToHeight="false" styleClass="clientes-scroll" xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.farmaciavictoria.proyectopharmavictoria.controller.Cliente.ClientesController">
   <content>
   <VBox styleClass="clientes-view" stylesheets="@/css/styles.css,@/css/clientes.css" spacing="0">
         <!-- HEADER -->
         <VBox spacing="0" styleClass="clientes-header-box">
            <children>
               <HBox alignment="CENTER_LEFT" spacing="20.0" styleClass="clientes-header">
                  <children>
                     <HBox alignment="CENTER_LEFT" spacing="8.0">
                        <children>
                           <ImageView fitHeight="28" fitWidth="28" preserveRatio="true">
                              <image>
                                 <Image url="@/icons/clientes.png" />
                              </image>
                           </ImageView>
                           <Label styleClass="clientes-header-title" text="GESTIÓN DE CLIENTES" />
                        </children>
                     </HBox>
                     <Region HBox.hgrow="ALWAYS" />
                     <HBox spacing="12" alignment="CENTER_RIGHT">
                        <children>
                           <Button fx:id="btnNuevoCliente" mnemonicParsing="false" onAction="#onNuevoCliente" styleClass="clientes-header-btn-blue">
                              <graphic>
                                 <ImageView fitHeight="22" fitWidth="22" preserveRatio="true">
                                    <image>
                                       <Image url="@/icons/agregarusuario.png" />
                                    </image>
                                 </ImageView>
                              </graphic>
                              <text>Nuevo Cliente</text>
                           </Button>
                           <Button fx:id="btnExportarClientes" mnemonicParsing="false" onAction="#onExportarClientes" styleClass="clientes-header-btn-export">
                              <graphic>
                                 <ImageView fitHeight="22" fitWidth="22" preserveRatio="true">
                                    <image>
                                       <Image url="@/icons/exportar.png" />
                                    </image>
                                 </ImageView>
                              </graphic>
                              <text>Exportar listado</text>
                           </Button>
                        </children>
                     </HBox>
                  </children>
                  <padding>
                     <Insets bottom="18.0" left="24.0" right="24.0" top="18.0" />
                  </padding>
               </HBox>
               <!-- Barra de filtros -->
               <HBox alignment="CENTER" spacing="24.0" styleClass="filter-bar">
                  <children>
                     <Label styleClass="filter-label" text="Buscar:" />
                     <ComboBox fx:id="cbTipoBusqueda" prefWidth="130.0" promptText="Tipo" styleClass="filter-combo" />
                     <TextField fx:id="txtBuscar" onKeyReleased="#onBuscar" prefWidth="220.0" promptText="DNI, nombre, apellidos, teléfono, email..." styleClass="search-field" />
                     <Label styleClass="filter-label" text="Estado:" />
                     <ComboBox fx:id="cmbEstado" onAction="#onFiltrarEstado" prefWidth="150.0" promptText="Todos" styleClass="filter-combo" />
                     <CheckBox fx:id="chkFrecuentes" onAction="#onToggleFrecuentes" styleClass="filter-checkbox" text="Solo frecuentes" selected="false" />
                     <Region HBox.hgrow="ALWAYS" />
                     <Label fx:id="lblTotalClientes" styleClass="total-clientes-label" text="Total: 0 clientes" />
                  </children>
                  <padding>
                     <Insets bottom="10.0" left="24.0" right="24.0" top="10.0" />
                  </padding>
               </HBox>
            </children>
         </VBox>

         <!-- TABLA DE CLIENTES -->
         <VBox spacing="0" styleClass="clientes-table-box" VBox.vgrow="ALWAYS">
            <children>
               <TableView fx:id="tablaClientes" styleClass="clientes-table" VBox.vgrow="ALWAYS">
                  <columns>
                     <TableColumn fx:id="colTipoCliente" minWidth="90.0" prefWidth="110.0" text="Tipo" />
                     <TableColumn fx:id="colDocumento" minWidth="120.0" prefWidth="140.0" text="Documento" />
                     <TableColumn fx:id="colNombreRazonSocial" minWidth="180.0" prefWidth="220.0" text="Nombre / Razón social" />
                     <TableColumn fx:id="colTelefono" minWidth="100.0" prefWidth="120.0" text="Teléfono" />
                     <TableColumn fx:id="colEmail" minWidth="140.0" prefWidth="180.0" text="Email" />
                     <TableColumn fx:id="colDireccion" minWidth="140.0" prefWidth="180.0" text="Dirección" />
                     <TableColumn fx:id="colAcciones" minWidth="120.0" prefWidth="150.0" text="Acciones" />
                  </columns>
                  <columnResizePolicy>
                     <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                  </columnResizePolicy>
               </TableView>
               <!-- Separador visual entre tabla y dashboard -->
               <Region minHeight="32.0" maxHeight="40.0" VBox.vgrow="NEVER" />
               <Separator orientation="HORIZONTAL" prefWidth="900" style="-fx-background-color: #e0e0e0; -fx-border-width: 2px;" />
               <Region minHeight="32.0" maxHeight="40.0" VBox.vgrow="NEVER" />
               <!-- Label de última actualización -->
               <Label fx:id="lblUltimaActualizacion" text="Última actualización: -" styleClass="actualizacion-label" />
               <!-- Controles de paginación -->
               <HBox alignment="CENTER" spacing="10.0" styleClass="pagination-bar">
                  <children>
                     <Button fx:id="btnPaginaAnterior" text="⟨ Anterior" />
                     <Label fx:id="lblPaginaActual" text="Página 1 de 1" />
                     <Button fx:id="btnPaginaSiguiente" text="Siguiente ⟩" />
                     <Label text="Mostrar:" styleClass="pagination-label" />
                     <ComboBox fx:id="cmbTamanoPagina" prefWidth="80.0" styleClass="pagination-combo" />
                     <Label text="por página" styleClass="pagination-label" />
                  </children>
                  <padding>
                     <Insets bottom="10.0" top="10.0" />
                  </padding>
               </HBox>
            </children>
         </VBox>

         <!-- DASHBOARD INFERIOR -->
         <Region minHeight="120.0" maxHeight="140.0" VBox.vgrow="NEVER" />
         <HBox alignment="CENTER" spacing="60.0" styleClass="dashboard-bar" VBox.vgrow="NEVER">
            <children>
               <VBox spacing="18.0" alignment="CENTER" prefWidth="650.0">
                  <!-- Eliminado título redundante -->
                  <BarChart fx:id="barChartTopClientes" title="" prefWidth="600.0" prefHeight="270.0">
                     <xAxis>
                        <CategoryAxis fx:id="barChartClientesXAxis" label="Cliente" />
                     </xAxis>
                     <yAxis>
                        <NumberAxis fx:id="barChartClientesYAxis" label="Compras" />
                     </yAxis>
                  </BarChart>
               </VBox>
               <VBox spacing="18.0" alignment="CENTER" prefWidth="400.0">
                  <Label text="Distribución por rango de edad" styleClass="dashboard-title" />
                  <PieChart fx:id="pieChartRangoEdad" title="" prefWidth="350.0" prefHeight="270.0" style="-fx-background-color: #fff; -fx-border-color: #e0e0e0; -fx-border-width: 1px;" />
               </VBox>
            </children>
            <padding>
               <Insets top="20.0" right="32.0" bottom="20.0" left="32.0" />
            </padding>
         </HBox>
      </VBox>
   </content>
</ScrollPane>

